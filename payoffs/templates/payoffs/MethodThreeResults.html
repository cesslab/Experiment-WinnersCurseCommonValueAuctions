{% extends "global/Page.html" %}
{% load staticfiles otree %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'phase_four/buyout_bet_lottery.css' %}">
  <link rel="stylesheet" href="{% static 'global/experiment.css' %}">
  <link rel="stylesheet" href="{% static 'payoffs/method_four.css' %}">
  <link href="{% static "phase_four/dice.css" %}" rel="stylesheet">
{% endblock %}

{% block title %}
  Earnings #3
{% endblock %}

{% block content %}
  <div class="main-container">
    <div class="title-item">
      <h3>Decision in Stage 4</h3>
    </div>
    <div class="single-column-container">
      <div class="full-width end underscored">
        <h4>You Rolled</h4>
      </div>
      <div class="die-container">
        <div id="ui_dado">
          <div id="platform">
            <div id="dice">
              <div class="side front">
                <div class="dtext center">A</div>
              </div>
              <div class="side front inner"></div>

              <div class="side top">
                <div class="center dtext">B</div>
              </div>
              <div class="side top inner"></div>

              <div class="side right">
                <div class="dtext center">C</div>
              </div>
              <div class="side right inner"></div>

              <div class="side left">
                <div class="dtext center">D</div>
              </div>
              <div class="side left inner"></div>

              <div class="side bottom">
                <div class="dtext center">E</div>
              </div>
              <div class="side bottom inner"></div>

              <div class="side back">
                <div class="dtext center">F</div>
              </div>
              <div class="side back inner"></div>

              <div class="side cover x"></div>
              <div class="side cover y"></div>
              <div class="side cover z"></div>
            </div>
          </div>
        </div>
        <div class="single-column-container">
          <div class="end underscored">
            <h4>Side Rolled</h4>
          </div>
          <div>
            <h4 id="outcome">-</h4>
          </div>
        </div>
      </div>
    </div>

    <div class="single-column-container full-width">
      <div class="full-width end underscored">
        <h4>Encoding</h4>
      </div>
      <div class="encoding-container">
        {% for pair in die_encoding %}
          <div><span class="badge badge-secondary">{{ pair.0 }}: Question {{ pair.1 }}</span></div>
        {% endfor %}
      </div>
      <div class="full-width end underscored">
        <h4>You Randomly Chose</h4>
      </div>
      <div><h4>Question {{ lottery.lid }}</h4></div>
    </div>

    <div class="single-column-container full-width">
      <div class="full-width end underscored">
        <h4>You Bet on {{ bet_color }}</h4>
      </div>
      {% if lottery.ltype == 1 %}
        {% if bet_color == 'Red' %}
          {% include 'phase_four/lottery_types/red_type_1.html' %}
        {% else %}
          {% include 'phase_four/lottery_types/lottery_type_1.html' %}
        {% endif %}
      {% else %}
        {% if bet_color == 'Red' %}
          {% include 'phase_four/lottery_types/red_type_2.html' %}
        {% else %}
          {% include 'phase_four/lottery_types/lottery_type_2.html' %}
        {% endif %}
      {% endif %}
    </div>

    <div class="single-column-container full-width">
      <div class="full-width end underscored">
        <h4>Your Cutoff</h4>
      </div>
      <div><h4>{{ cutoff }}</h4></div>
      <div class="full-width end underscored">
        <h4>Random Cutoff</h4>
      </div>
      <div><h4>{{ random_cutoff }}</h4></div>
    </div>

    {% if not play_lottery %}
      <div class="plain-title-item">
        <h4>
          The random price of {{ random_cutoff }} was greater than or equal to your minimum compensation
          of {{ cutoff }}.
        </h4>
      </div>
      <div class="plain-title-item">
        <h4>Your earnings #2 are the random price {{ random_cutoff }}.</h4>
      </div>
    {% else %}
      <div class="plain-title-item">
        <h4>
          The random price of {{ random_cutoff }} was <b>less than your minimum compensation</b>
          of {{ cutoff }}.
        </h4>
      </div>
      <div class="plain-title-item">
        <h4>
          You will play the lottery.
        </h4>
      </div>
    {% endif %}
    <div class="single-column-container full-width">
      {% include 'payoffs/snippets/realized_lottery_table.html' %}
    </div>

    <div class="single-column-container full-width">
      <div class="full-width end underscored">
        <h4>Actual</h4>
      </div>
      <div><h4>{{ realized_value }}</h4></div>
    </div>


    {% if play_lottery %}
      <div class="plain-title-item">
        <h5>
          Your earnings #3 are <b>{{ earnings|floatformat }}</b>.
        </h5>
      </div>
    {% endif %}

  </div>
  <button id="next-button" class="otree-btn-next btn btn-primary">Next</button>
{% endblock %}

{% block scripts %}
  <script>
      var platform = $('#platform');
      var letters = ['A', 'B', 'C', 'D', 'E', 'F'];
      var number = {{ rolled_side }};

      (function () {
          var x = 0, y = 20, z = -20;
          switch (number) {
              case 1:
                  x = 0;
                  y = 20;
                  z = -20;
                  break;
              case 2:
                  x = -100;
                  y = -150;
                  z = 10;
                  break;
              case 3:
                  x = 0;
                  y = -100;
                  z = -10;
                  break;
              case 4:
                  x = 0;
                  y = 100;
                  z = -10;
                  break;
              case 5:
                  x = 80;
                  y = 120;
                  z = -10;
                  break;
              case 6:
                  x = 0;
                  y = 200;
                  x = 10;
                  break;
          }

          $('#dice').css({
              'transform': 'rotateX(' + x + 'deg) rotateY(' + y + 'deg) rotateZ(' + z + 'deg)'
          });

          platform.css({
              'transform': 'translate3d(0,0, 0px)'
          });

          $('#outcome').text(letters[number - 1]);
      })();

  </script>
{% endblock %}
